# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## バージョン管理

**現在のバージョン: 1.2**

- コードに変更を加えるたびにバージョン番号を1ずつ増やすこと
- バージョン番号は `index.html` の遊び方ダイアログ内にも表示されている（`help-version`要素）
- 両方を同時に更新すること

## Important Restrictions

**Do not reference or edit files outside of this directory (ver2).** Parent directories and sibling folders are off-limits.

## プロジェクト概要

コリドール（Quoridor）をローカルで動作するウェブサイトとして実装する。
ゲームルールは `game_rule.md` に記載。

## 開発方針

- 将来的にCPUプレイヤーを実装予定（本フェーズでは準備のみ）
- CPU実装を見据えたデータ表現を設計する
- まずはゲームがウェブで動作することを確認し、アルゴリズム検討用の環境を整える

## 機能要件

1. **対戦モード**: 2人のプレイヤーが交互に操作できる
2. **盤面編集モード**: 任意の盤面状態を自由に設定できる（アルゴリズム検討用）
3. **エクスポート/インポート**: 盤面状態を文字列として出力・読み込みできる

## 技術スタック

- **言語**: JavaScript (ES6+)
- **描画**: p5.js
- **実行環境**: ブラウザ（ローカル動作）

## 座標系

- **プレイヤー座標**: 9×9 (0〜8)、左上が(0,0)
- **壁座標**: 8×8 (0〜7)、マス間の交点を表す

## データ構造

```javascript
gameState = {
  players: [
    { x, y, wallsLeft },  // プレイヤー1（y=0から開始）
    { x, y, wallsLeft }   // プレイヤー2（y=8から開始）
  ],
  walls: 8×8配列,  // 0=なし, 1=縦壁, 2=横壁
  currentPlayer: 0 or 1,
  history: []
}
```

## 主要な関数

- `setup()` / `draw()` - p5.js初期化・描画
- `getLegalMoves()` - 合法手の計算
- `canPlaceWall()` - 壁配置の妥当性検証（経路保証含む）
- `isBlocked()` - 壁による移動ブロック判定

## UI操作（PC・マウス）

- 右クリック: 移動モード/壁設置モードの切り替え
- 移動マーカーは両モードで常に表示
- 手番プレイヤーの駒に黒縁を描画
- マウスホイール: 壁の向き変更（初期:縦）
- 勝利時: 勝者表示→編集モードへ移行
- 内部状態は常時表示、コピー/ペースト/反映可能

### 対戦モード
- 移動モード: マーカークリックで移動
- 壁設置モード: 壁影プレビュー、クリックで配置

### 編集モード
- 移動モード: 駒をドラッグして任意のマスに配置
- 壁設置モード: 既存壁にカーソルを近づけると色が変わり、クリックで削除。空き位置でクリックで配置（重複不可、経路保証なし）
