# 16. スマホ用UI設計

## 目的

スマホでプレイ可能な最低限のUIを持つQuoridorウェブサイトを構築する。

## 基本方針

- **index.html**: スマホ用（本番）
- **dev.html**: 開発用（現在のindex.htmlをリネーム）
- **renderer.js の分離**: スマホ用とPC用で別ファイル
- **その他のjs**: 共有（board.js, game.js, input.js, constants.js）

---

## ファイル構成

```
ver2/
├── index.html          # スマホ用（新規）
├── dev.html            # 開発用（現index.htmlをリネーム）
├── css/
│   ├── style.css       # 開発用CSS
│   └── mobile.css      # スマホ用CSS（新規）
├── js/
│   ├── constants.js    # 共有
│   ├── game.js         # 共有
│   ├── board.js        # 共有
│   ├── input.js        # 共有（一部拡張）
│   ├── renderer.js     # 開発用
│   ├── renderer_mobile.js  # スマホ用（新規）
│   ├── main.js         # 開発用
│   └── main_mobile.js  # スマホ用（新規）
└── assets/
    └── robot.svg       # ロボットアイコン（新規）
```

---

## ゲーム開始フロー

### ポップアップダイアログ

ゲーム開始時・リセット時にポップアップを表示。
**文字は最小限、アイコン中心のモダンデザイン。**

#### 1人用選択時

```
┌─────────────────────────────┐
│                             │
│   ┌─────────┐ ┌─────────┐   │
│   │         │ │         │   │
│   │ 🤖 vs 👤 │ │ 👤 vs 👤 │   │
│   │         │ │         │   │
│   └─────────┘ └─────────┘   │
│     [選択中]                │
│                             │
│   ┌─────────┐ ┌─────────┐   │
│   │   🔵    │ │    🔴   │   │
│   │   ▲     │ │    ▲    │   │
│   │  先手   │ │   後手  │   │
│   └─────────┘ └─────────┘   │
│                             │
│         [ ▶ ]               │
│                             │
└─────────────────────────────┘
```

#### 2人用選択時（先手/後手選択なし）

```
┌─────────────────────────────┐
│                             │
│   ┌─────────┐ ┌─────────┐   │
│   │         │ │         │   │
│   │ 🤖 vs 👤 │ │ 👤 vs 👤 │   │
│   │         │ │         │   │
│   └─────────┘ └─────────┘   │
│               [選択中]      │
│                             │
│         [ ▶ ]               │
│                             │
└─────────────────────────────┘
```

### 選択項目

1. **モード選択**: 1人用（🤖 vs 👤） / 2人用（👤 vs 👤）
2. **先手/後手**（1人用のみ）: 先手（🔵）/ 後手（🔴）

---

## UI設計

### 画面レイアウト（1人用モード）

```
┌─────────────────────────────┐
│                  [🔄] [↩️]  │  ヘッダー（右寄せ）
├─────────────────────────────┤
│  🤖 ●●●●●●●●○○             │  CPU + 残り壁
│  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓  │  ゴールライン（赤）
├─────────────────────────────┤
│                             │
│                             │
│        盤面（9x9）          │
│                             │
│                             │
├─────────────────────────────┤
│  ░░░░░░░░░░░░░░░░░░░░░░░░  │  ゴールライン（青）
│  👤 ●●●●●●●●○○             │  プレイヤー + 残り壁
├─────────────────────────────┤
│  ┌───────────┬───────────┐  │
│  │     ║     │     ═     │  │  壁ドラッグ領域
│  │     ║     │     ═     │  │  （アイコンのみ）
│  └───────────┴───────────┘  │
└─────────────────────────────┘
```

### 画面レイアウト（2人用モード）

```
┌─────────────────────────────┐
│                  [🔄] [↩️]  │  ヘッダー（右寄せ）
├─────────────────────────────┤
│  ┌───────────┬───────────┐  │
│  │     ║     │     ═     │  │  P2用 壁領域
│  └───────────┴───────────┘  │
│  👤 ●●●●●●●●○○             │  P2 + 残り壁
│  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓  │  ゴールライン（赤）
├─────────────────────────────┤
│                             │
│        盤面（9x9）          │
│                             │
├─────────────────────────────┤
│  ░░░░░░░░░░░░░░░░░░░░░░░░  │  ゴールライン（青）
│  👤 ●●●●●●●●○○             │  P1 + 残り壁
├─────────────────────────────┤
│  ┌───────────┬───────────┐  │
│  │     ║     │     ═     │  │  P1用 壁領域
│  └───────────┴───────────┘  │
└─────────────────────────────┘
```

### 色設計

| 要素 | 色 |
|------|-----|
| P1（下側）駒 | 青 #3498db |
| P2（上側）駒 | 赤 #e74c3c |
| P1ゴールライン | 薄い青 |
| P2ゴールライン | 薄い赤 |
| 壁 | 茶色 #8B4513 |
| 移動可能マス | 黄色（半透明）|
| 縦壁領域 | 薄い茶色（左） |
| 横壁領域 | 薄い茶色（右） |

---

## 操作方法

### 駒の移動

1. 移動可能なマスが黄色でハイライト表示
2. 駒をドラッグして移動先にドロップ
3. または移動可能マスをタップ

### 壁の配置

1. 画面下部の壁領域（左=縦壁、右=横壁）からドラッグ開始
2. 盤面上の配置したい位置へドラッグ
3. **壁プレビューは指の位置より上にオフセット表示**（指で隠れない）
4. ドロップで配置確定
5. 配置不可の場合は元に戻る

```
     ↑ 壁プレビュー（指の50px上に表示）
     │
   ┌─┴─┐
   │ 指 │  ← タッチ位置
   └───┘
```

### ボタン

| ボタン | アイコン | 機能 |
|--------|---------|------|
| リスタート | 🔄 | ポップアップを表示してゲームをリセット |
| 1手戻る | ↩️ | 2手分戻す（自分+相手）|

---

## Undo機能（↩️ボタン）

### 動作

- **1人用**: 2手戻す（自分の手 + CPUの手）
- **2人用**: 1手戻す（直前の1手のみ）

### 履歴管理

```javascript
class MoveHistory {
  constructor() {
    this.states = [];  // GameStateのスナップショット
  }

  // 手を打つ前に現在状態を保存
  saveState(state) {
    this.states.push(state.clone());
  }

  // n手戻す
  undo(count) {
    for (let i = 0; i < count && this.states.length > 0; i++) {
      this.states.pop();
    }
    // 最後の状態を返す（なければnull）
    return this.states.length > 0
      ? this.states[this.states.length - 1].clone()
      : null;
  }

  canUndo(count) {
    return this.states.length >= count;
  }

  clear() {
    this.states = [];
  }
}
```

---

## CPU思考中アニメーション

### 表示

- CPUの駒の周りに回転するドット（3つ）
- 「🤖💭」のような思考中表示

### 実装

```javascript
// UIStateに追加
this.cpuThinking = false;

// 描画時
if (uiState.cpuThinking) {
  drawThinkingAnimation(cpuX, cpuY);
}
```

```css
@keyframes thinking-dots {
  0%, 80%, 100% { opacity: 0.3; }
  40% { opacity: 1; }
}

.thinking-dot:nth-child(1) { animation-delay: 0s; }
.thinking-dot:nth-child(2) { animation-delay: 0.2s; }
.thinking-dot:nth-child(3) { animation-delay: 0.4s; }
```

---

## 残り壁表示

### デザイン

```
🤖 ●●●●●●●●○○
```

- ● = 残り壁（塗りつぶし円）
- ○ = 使用済み（空の円）
- プレイヤーアイコンの横に横並び

---

## 壁ドラッグ領域

### デザイン（文字なし・アイコンのみ）

```
┌─────────────┬─────────────┐
│      ║      │      ═      │
│      ║      │      ═      │
│      ║      │      ═      │
└─────────────┴─────────────┘
```

- 左半分: 縦壁アイコン（太めの縦線）
- 右半分: 横壁アイコン（太めの横線）
- 背景色で区別（左: 薄いグレー、右: 少し濃いグレー）
- 壁の残数が0の場合はグレーアウト

---

## デザイン方針

- **文字は最小限**
- **アイコン中心**
- **モダン・ミニマル**
- 角丸、シャドウ、適度な余白
- カラーパレット: 青(#3498db)、赤(#e74c3c)、茶(#8B4513)、グレー系

---

## 完了条件

- [ ] index.html（スマホ用）が動作
- [ ] dev.html（開発用）が従来通り動作
- [ ] ポップアップでモード選択（1人用/2人用）
- [ ] 1人用のみ先手/後手選択表示
- [ ] 駒のドラッグ移動が動作
- [ ] 壁のドラッグ配置が動作（指より上にプレビュー）
- [ ] 壁領域はアイコンのみ（文字なし）
- [ ] 2人用で上下に壁領域表示
- [ ] リスタートでポップアップ表示
- [ ] 1人用: Undoで2手戻る / 2人用: Undoで1手戻る
- [ ] 残り壁が各プレイヤーの近くに表示
- [ ] ゴールラインが色分けされている
- [ ] CPU思考中にアニメーション表示
- [ ] モダンでミニマルなデザイン

---

## 実装順序

1. dev.html作成（現index.htmlをリネーム）
2. index.html作成（スマホ用骨格）
3. mobile.css作成（モダンデザイン）
4. ポップアップダイアログ実装
5. renderer_mobile.js作成（基本描画）
6. main_mobile.js作成
7. 駒のドラッグ移動実装
8. 壁のドラッグ配置実装（オフセット表示）
9. CPU対戦実装
10. Undo機能実装（モード別）
11. アニメーション実装
